<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Exploring Systems Like a Scientist — Case Study Review</title>
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,opsz,wght@0,9..40,300;0,9..40,400;0,9..40,500;0,9..40,600;0,9..40,700;1,9..40,400&display=swap" rel="stylesheet">
<style>
:root{--navy:#1B2A4A;--teal:#2E8B8B;--slate:#5A6B7F;--light-slate:#8896A6;--border:#E2E8F0;--bg:#FAFBFC;--card-bg:#fff;--health-bg:#E8F4F8;--health-text:#2A7B9B;--health-dot:#4A90A4;--biz-bg:#EBF2EB;--biz-text:#4A6B4A;--biz-dot:#6B8E6B;--edu-bg:#FDF2E6;--edu-text:#8B6914;--edu-dot:#C4883A;--it-bg:#EEEAF4;--it-text:#5B4D8A;--it-dot:#7B6BA4;--std-bg:#F0F4F8;--std-text:#1B2A4A;--spur-bg:#FFF8F0;--spur-text:#8B4513;--spur-border:#D2691E}
*{box-sizing:border-box;margin:0;padding:0}
body{font-family:'DM Sans',system-ui,sans-serif;background:var(--bg);color:#1a1a2e;line-height:1.5;-webkit-font-smoothing:antialiased}
.container{max-width:1300px;margin:0 auto;padding:36px 24px 60px}
.login-overlay{position:fixed;inset:0;background:rgba(27,42,74,.6);display:flex;align-items:center;justify-content:center;z-index:1000;backdrop-filter:blur(6px)}
.login-overlay.hidden{display:none}
.login-card{background:#fff;border-radius:16px;padding:40px 48px;text-align:center;box-shadow:0 20px 60px rgba(0,0,0,.2);max-width:420px;width:90%}
.login-card h2{font-size:22px;color:var(--navy);margin-bottom:6px}
.login-card p{font-size:14px;color:var(--slate);margin-bottom:24px;line-height:1.5}
.login-form{display:flex;gap:10px}
.login-form input{flex:1;padding:12px 16px;border:2px solid var(--border);border-radius:10px;font-size:16px;font-family:inherit;outline:none;transition:border-color .2s}
.login-form input:focus{border-color:var(--teal)}
.login-form button{padding:12px 24px;border-radius:10px;border:none;background:var(--teal);color:#fff;font-size:15px;font-weight:600;font-family:inherit;cursor:pointer;transition:background .15s;white-space:nowrap}
.login-form button:hover{background:#257373}
.login-form button:disabled{background:#B0BBC8;cursor:default}
.login-returning{margin-top:20px;padding-top:18px;border-top:1px solid var(--border)}
.login-returning p{font-size:13px;color:var(--light-slate);margin-bottom:10px}
.returning-buttons{display:flex;gap:8px;flex-wrap:wrap;justify-content:center}
.returning-btn{display:inline-flex;align-items:center;gap:6px;padding:8px 16px;border-radius:20px;border:1.5px solid var(--border);background:#fff;font-size:14px;font-weight:500;font-family:inherit;cursor:pointer;transition:all .15s;color:var(--navy)}
.returning-btn:hover{border-color:var(--teal);background:#F0F7F7}
.returning-btn .av{width:24px;height:24px;border-radius:50%;display:flex;align-items:center;justify-content:center;color:#fff;font-weight:700;font-size:11px}
.header{margin-bottom:28px}
.header-top{display:flex;justify-content:space-between;align-items:flex-start;flex-wrap:wrap;gap:12px}
.header h1{font-size:26px;font-weight:700;color:var(--navy);letter-spacing:-.03em;line-height:1.2}
.header .subtitle{font-size:15px;color:var(--slate);margin-top:4px}
.user-badge{display:none;align-items:center;gap:8px;padding:8px 16px;border-radius:24px;font-size:14px;font-weight:600;color:#fff;cursor:pointer;transition:opacity .15s}
.user-badge:hover{opacity:.85}
.user-badge .av-sm{width:28px;height:28px;border-radius:50%;background:rgba(255,255,255,.3);display:flex;align-items:center;justify-content:center;font-weight:700;font-size:13px}
.user-badge .hint{font-size:11px;opacity:.8;font-weight:400}
.header .context{margin-top:14px;padding:14px 18px;background:linear-gradient(135deg,#F0F7F7,#F5F0F8);border-radius:10px;border-left:4px solid var(--teal);font-size:13.5px;color:#3D4F5F;line-height:1.65}
.header .context strong{color:var(--navy)}
.comp-legend{display:flex;gap:10px;margin-top:10px;flex-wrap:wrap}
.comp-pill{display:inline-flex;align-items:center;gap:6px;padding:4px 12px;border-radius:8px;font-size:12px;font-weight:600}
.comp-pill.c1{background:#E3F1E3;color:#2D6A2D}.comp-pill.c2{background:#FDE8D8;color:#B35900}.comp-pill.c3{background:#DDE8F8;color:#1B4D8A}
.rating-legend{margin-top:12px;padding:10px 18px;background:#fff;border-radius:8px;border:1px solid var(--border);display:flex;align-items:center;gap:16px;font-size:13px;color:var(--slate);flex-wrap:wrap}
.rating-legend strong{color:var(--navy)}
.rating-legend .se{color:#F0B429;font-size:15px}
.filter-bar{display:flex;gap:12px;flex-wrap:wrap;align-items:center;margin-bottom:16px;padding:14px 18px;background:var(--card-bg);border-radius:10px;border:1px solid var(--border);box-shadow:0 1px 3px rgba(0,0,0,.04)}
.search-wrap{flex:1 1 240px;min-width:180px;position:relative}
.search-wrap svg{position:absolute;left:12px;top:50%;transform:translateY(-50%);color:#B0BBC8;pointer-events:none}
.filter-bar input[type="text"]{width:100%;padding:8px 14px 8px 36px;border:1.5px solid #D1D9E6;border-radius:7px;font-size:14px;font-family:inherit;outline:none;background:#F7F9FC;transition:border-color .2s,box-shadow .2s}
.filter-bar input[type="text"]:focus{border-color:var(--teal);box-shadow:0 0 0 3px rgba(46,139,139,.1)}
.pill-group{display:flex;gap:5px;flex-wrap:wrap}.pill-group.right{margin-left:auto}
.pill-btn{padding:6px 14px;border-radius:20px;border:1.5px solid #D1D9E6;background:#fff;color:var(--slate);font-size:13px;font-weight:400;font-family:inherit;cursor:pointer;transition:all .15s;line-height:1.2;white-space:nowrap}
.pill-btn:hover{border-color:#B0BBC8;background:#F7F9FC}
.pill-btn.act-all{border:2px solid var(--navy);background:var(--navy);color:#fff;font-weight:600}
.pill-btn.act-health{border:2px solid var(--health-dot);background:var(--health-bg);color:var(--health-text);font-weight:600}
.pill-btn.act-biz{border:2px solid var(--biz-dot);background:var(--biz-bg);color:var(--biz-text);font-weight:600}
.pill-btn.act-edu{border:2px solid var(--edu-dot);background:var(--edu-bg);color:var(--edu-text);font-weight:600}
.pill-btn.act-it{border:2px solid var(--it-dot);background:var(--it-bg);color:var(--it-text);font-weight:600}
.pill-btn.act-std{border:2px solid var(--navy);background:var(--std-bg);color:var(--std-text);font-weight:600}
.pill-btn.act-spur{border:2px solid var(--spur-border);background:var(--spur-bg);color:var(--spur-text);font-weight:600}
.count-bar{font-size:13px;color:var(--light-slate);margin-bottom:8px;padding-left:4px;display:flex;align-items:center;gap:12px}
.collapse-link{color:var(--teal);cursor:pointer;text-decoration:none}.collapse-link:hover{text-decoration:underline}
.sync-status{margin-left:auto;font-size:12px}.sync-status.saving{color:var(--teal)}.sync-status.saved{color:#6B8E6B}.sync-status.error{color:#C25178}

/* ✅ UPDATED: keep table aligned to upper section width */
.table-wrap{width:100%;max-width:100%;background:var(--card-bg);border-radius:10px;border:1px solid var(--border);box-shadow:0 1px 3px rgba(0,0,0,.04)}
.table-scroll{width:100%;overflow-x:auto}
/* ✅ UPDATED: fixed layout so it doesn’t overflow weirdly */
table{width:100%;table-layout:fixed;border-collapse:collapse;font-size:14px}

thead tr{background:#F7F9FC;border-bottom:2px solid var(--border)}
th{padding:11px 12px;text-align:left;font-size:11px;font-weight:600;color:var(--slate);text-transform:uppercase;letter-spacing:.05em;white-space:nowrap;user-select:none}
th.sortable{cursor:pointer}th.sortable:hover{color:var(--navy)}
.si{font-size:10px;margin-left:3px;opacity:.3}.si.on{opacity:1}
td{padding:10px 12px;vertical-align:top}
tbody tr{border-bottom:1px solid #EEF1F5;cursor:pointer;transition:background .12s}
tbody tr:nth-child(even){background:#FAFBFC}tbody tr:hover{background:#F0F5FA!important}
tbody tr.expanded{background:#F8FAFE!important;border-bottom:none}
.cell-id{text-align:center;font-weight:600;color:var(--light-slate);font-size:12px}
.cell-title{font-weight:600;color:var(--navy);font-size:13.5px}
.cell-scenario{color:#4A5568;line-height:1.55;font-size:12.5px}
.bc{display:inline-block;padding:3px 9px;border-radius:12px;font-size:11px;font-weight:600;white-space:nowrap}
.bc.std{background:var(--std-bg);color:var(--std-text)}.bc.spur{background:var(--spur-bg);color:var(--spur-text)}
.bd{display:inline-flex;align-items:center;gap:5px;padding:3px 9px;border-radius:12px;font-size:11.5px;font-weight:500}
.bd .dot{width:7px;height:7px;border-radius:50%;flex-shrink:0}
.bd.health{background:var(--health-bg);color:var(--health-text)}.bd.health .dot{background:var(--health-dot)}
.bd.biz{background:var(--biz-bg);color:var(--biz-text)}.bd.biz .dot{background:var(--biz-dot)}
.bd.edu{background:var(--edu-bg);color:var(--edu-text)}.bd.edu .dot{background:var(--edu-dot)}
.bd.it{background:var(--it-bg);color:var(--it-text)}.bd.it .dot{background:var(--it-dot)}
.chev{display:inline-block;width:24px;height:24px;border-radius:50%;background:#EEF1F5;color:var(--light-slate);font-size:14px;line-height:24px;text-align:center;transition:all .2s}
.chev.open{background:var(--teal);color:#fff;transform:rotate(180deg)}
.rc{min-width:210px}.rr{display:flex;flex-direction:column;gap:5px}
.rw{display:flex;align-items:center;gap:7px;font-size:12px}
.ra{width:22px;height:22px;border-radius:50%;display:flex;align-items:center;justify-content:center;color:#fff;font-weight:700;font-size:10px;flex-shrink:0}
.rn{min-width:48px;max-width:70px;font-weight:600;color:var(--slate);font-size:11px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
.stars{display:flex;gap:2px}
.star{font-size:18px;cursor:pointer;color:#D1D9E6;transition:color .1s;line-height:1;user-select:none}
.star.filled{color:#F0B429}.star.of{color:#F0B429;cursor:default}.star.hov{color:#FFCB47}.star.dis{cursor:default}
.nr{font-size:11px;color:#C0C8D4;font-style:italic}
tr.detail-row{background:#F8FAFE!important;border-bottom:2px solid var(--teal)}
tr.detail-row td{padding:4px 14px 18px 14px}
.dg{display:grid;grid-template-columns:1fr 1fr 1fr;gap:12px;margin-bottom:14px}
.dc{background:#fff;border-radius:8px;padding:12px 14px;border:1px solid var(--border)}
.dch{display:flex;align-items:center;gap:7px;font-size:11.5px;font-weight:700;color:var(--navy);margin-bottom:8px;text-transform:uppercase;letter-spacing:.03em}
.cb{display:inline-block;padding:2px 7px;border-radius:6px;font-size:10.5px;font-weight:700}
.cb.c1{background:#E3F1E3;color:#2D6A2D}.cb.c2{background:#FDE8D8;color:#B35900}.cb.c3{background:#DDE8F8;color:#1B4D8A}
.dl{font-size:10.5px;font-weight:600;color:var(--light-slate);margin-bottom:3px;text-transform:uppercase;letter-spacing:.04em}
.dcl{font-size:12.5px;color:#4A5568;line-height:1.55;font-style:italic}
.ds{font-size:12.5px;color:#4A5568;line-height:1.55}
.ns{margin-top:2px}.ns h4{font-size:12px;font-weight:700;color:var(--navy);margin-bottom:8px;text-transform:uppercase;letter-spacing:.03em}
.ng{display:flex;gap:12px;flex-wrap:wrap}
.nc{background:#fff;border-radius:8px;padding:10px 12px;border:1px solid var(--border);flex:1 1 220px;min-width:220px;max-width:380px}
.nch{display:flex;align-items:center;gap:6px;margin-bottom:6px}
.nch .ra{width:20px;height:20px;font-size:9px}
.nch span{font-size:12px;font-weight:600;color:var(--slate)}
.nc textarea{width:100%;min-height:60px;border:1.5px solid var(--border);border-radius:6px;padding:8px 10px;font-size:13px;font-family:inherit;resize:vertical;outline:none;transition:border-color .2s;background:#FAFBFC}
.nc textarea:focus{border-color:var(--teal);background:#fff}
.nc .on{font-size:13px;color:#4A5568;line-height:1.5;padding:8px 10px;background:#F7F9FC;border-radius:6px;min-height:40px}
.nc .en{font-size:12px;color:#C0C8D4;font-style:italic;padding:8px 10px}
.legend{margin-top:20px;padding:14px 20px;background:var(--card-bg);border-radius:10px;border:1px solid var(--border);display:flex;flex-wrap:wrap;gap:20px;align-items:center;font-size:12px;color:var(--light-slate)}
.legend strong{color:var(--slate);font-weight:600}.legend .lr{margin-left:auto;color:#AAB4C0}
.empty-state{text-align:center;padding:48px 20px;color:var(--light-slate);font-size:14px}
@media print{.login-overlay,.filter-bar,.count-bar,.legend,.user-badge{display:none}.container{padding:20px}}
@media(max-width:900px){.dg{grid-template-columns:1fr}.ng{flex-direction:column}.pill-group.right{margin-left:0}}
</style>
</head>
<body>
<div class="login-overlay" id="loginOverlay">
  <div class="login-card">
    <h2>Welcome, reviewer!</h2>
    <p>Enter your name to start rating case studies.<br>Everyone can see all ratings and notes.</p>
    <div class="login-form">
      <input type="text" id="loginInput" placeholder="Your name" maxlength="30" onkeydown="if(event.key==='Enter')loginGo()">
      <button onclick="loginGo()" id="loginBtn" disabled>Join</button>
    </div>
    <div class="login-returning" id="retSection" style="display:none">
      <p>Or continue as:</p>
      <div class="returning-buttons" id="retBtns"></div>
    </div>
  </div>
</div>

<div class="container">
  <div class="header">
    <div class="header-top">
      <div>
        <h1>Exploring Systems Like a Scientist</h1>
        <div class="subtitle">Case Study Options — 20 scenarios for SME review</div>
      </div>
      <div class="user-badge" id="userBadge" onclick="switchUser()">
        <span class="av-sm" id="userAv"></span>
        <span id="userNm"></span>
        <span class="hint">(switch)</span>
      </div>
    </div>
    <div class="context">
      Each case study supports all three course competencies through a single real-world scenario. Students choose one scenario and explore all competencies — a <strong>"choose your own adventure"</strong> model. Scoped to <strong>NGSS Grade 8 ceiling</strong> at <strong>Level 2</strong>.
      <div class="comp-legend">
        <span class="comp-pill c1">C1 — Support a Scientific Claim</span>
        <span class="comp-pill c2">C2 — Evaluate a Scientific Claim</span>
        <span class="comp-pill c3">C3 — Explain the System</span>
      </div>
    </div>
    <div class="rating-legend">
      <div class="rating-legend">
        <strong>Rating scale:</strong>
        <span><span class="star-example">★</span> = Least preferred</span>
        <span><span class="star-example">★★</span> = Low preference</span>
        <span><span class="star-example">★★★</span> = Neutral</span>
        <span><span class="star-example">★★★★</span> = High preference</span>
        <span><span class="star-example">★★★★★</span> = Top choice</span>
      </div>
    </div>
  </div>

  <div class="filter-bar">
    <div class="search-wrap">
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
      <input type="text" id="searchInput" placeholder="Search titles, scenarios, claims...">
    </div>

    <div class="pill-group" id="domFilt">
      <button class="pill-btn act-all" data-v="All">All Domains</button>
      <button class="pill-btn" data-v="Healthcare">Healthcare</button>
      <button class="pill-btn" data-v="Business">Business</button>
      <button class="pill-btn" data-v="Education">Education</button>
      <button class="pill-btn" data-v="IT">IT</button>
    </div>

    <div class="pill-group right" id="colFilt">
      <button class="pill-btn act-all" data-v="All">Both</button>
      <button class="pill-btn" data-v="Standard">Standard</button>
      <button class="pill-btn" data-v="Spurious Correlations">Spurious</button>
    </div>

    <!-- ✅ UPDATED: Removed Restart button, kept Sign out only -->
    <div class="pill-group right">
      <button class="pill-btn" id="btnSignout" title="Signs out on this device">Sign out</button>
    </div>
  </div>

  <div class="count-bar">
    <span>Showing <strong id="fCnt">20</strong> of 20</span>
    <a class="collapse-link" id="colAll" style="display:none">← Collapse all</a>
    <span class="sync-status" id="syncSt"></span>
  </div>

  <div class="table-wrap"><div class="table-scroll">
    <table>
      <thead><tr>
        <th style="width:44px;text-align:center">#</th>
        <th class="sortable" style="width:95px" data-sort="collection">Collection <span class="si">↕</span></th>
        <th class="sortable" style="min-width:160px" data-sort="title">Case Study <span class="si">↕</span></th>
        <th class="sortable" style="width:95px" data-sort="domain">Domain <span class="si">↕</span></th>
        <th style="min-width:260px">Scenario Overview</th>
        <th style="min-width:210px">Rankings</th>
        <th style="width:44px;text-align:center"></th>
      </tr></thead>
      <tbody id="tBody"></tbody>
    </table>
  </div></div>

  <div class="legend">
    <strong>Collections:</strong>
    <span><span class="bc std">Standard</span> 12 real-world</span>
    <span><span class="bc spur">Spurious</span> 8 misleading correlations</span>
    <span class="lr">Click any row for detail + notes</span>
  </div>
</div>

<script>
const API = "https://script.google.com/macros/s/AKfycby1cSVwTV6iXg4Yn_KLTeHlwn-QdKBKsEFstB9zABMiiqHxOcNk7U_rm6VeDwQgF8g7/exec";
const PAL=['#C25178','#3A8FBF','#5E9E5E','#9B6EC5','#D4853A','#4A8F8F','#C4564A','#7B8EC2'];
const DC={Healthcare:'health',Business:'biz',Education:'edu',IT:'it'};
const CASES=[
{id:'A1',co:'Standard',t:'Antibiotic Resistance',d:'Healthcare',s:'Explores how antibiotic use in healthcare, agriculture, and everyday life contributes to antibiotic-resistant infections and the system connecting farms, food supply, hospitals, and regulation.',c1:'Overuse of antibiotics in livestock farming contributes to antibiotic-resistant infections in humans.',c2:'Organic meat is safer because it has no antibiotic-resistant bacteria.',c3:'Livestock farms \u2192 food supply chain \u2192 hospitals \u2192 pharmaceutical companies \u2192 government regulation'},
{id:'A2',co:'Standard',t:'Screen Time & Adolescent Mental Health',d:'Healthcare',s:'Examines evidence connecting smartphone/social media use to rising teen anxiety and depression. Evaluate sensationalized claims against nuanced research.',c1:'Increased social media use is associated with higher rates of anxiety and depression in teenagers.',c2:'Phones are destroying our kids\u2019 brains\u2014studies PROVE it!',c3:'Social media platforms \u2192 teens \u2192 parents \u2192 schools \u2192 mental health services \u2192 tech companies'},
{id:'A3',co:'Standard',t:'Vaccination & Herd Immunity',d:'Healthcare',s:'Explores how individual vaccination decisions affect community-wide disease protection and herd immunity thresholds.',c1:'When vaccination rates fall below herd immunity thresholds, disease outbreaks become more likely.',c2:'Natural immunity is always better than vaccine immunity.',c3:'Individual decisions \u2192 community health \u2192 public health infrastructure \u2192 disease dynamics \u2192 regulation'},
{id:'A4',co:'Standard',t:'Fast Fashion & Sustainability',d:'Business',s:'Investigates environmental and social costs of rapid, inexpensive clothing production\u2014textile waste, water pollution, carbon emissions, labor conditions.',c1:'Fast fashion significantly contributes to textile waste and water pollution globally.',c2:'Buying \u2018sustainable\u2019 clothing lines from fast fashion brands solves the environmental problem.',c3:'Consumer demand \u2192 brands \u2192 factories \u2192 workers \u2192 environment \u2192 waste management \u2192 regulation'},
{id:'A5',co:'Standard',t:'Remote Work Productivity',d:'Business',s:'Analyzes competing claims about remote vs. in-office productivity following the pandemic-era shift.',c1:'Remote work productivity depends on task type, management practices, and individual circumstances.',c2:'Remote workers are less productive because they\u2019re distracted at home.',c3:'Workers \u2192 managers \u2192 technology \u2192 office culture \u2192 real estate \u2192 work-life balance \u2192 policy'},
{id:'A6',co:'Standard',t:'Food Delivery Apps & Local Restaurants',d:'Business',s:'Examines how delivery platforms transformed restaurant operations\u2014promising orders while charging significant fees.',c1:'Food delivery apps increase visibility but reduce profit margins through high commission fees.',c2:'Food delivery apps are saving local restaurants by expanding their customer base.',c3:'Restaurants \u2192 delivery platforms \u2192 drivers \u2192 consumers \u2192 local economy \u2192 labor markets'},
{id:'A7',co:'Standard',t:'Class Size & Student Achievement',d:'Education',s:'Evaluates whether reducing class sizes actually improves student learning\u2014an expensive but popular policy.',c1:'Smaller class sizes can improve outcomes, but the effect depends on teacher quality and instructional practices.',c2:'Simply reducing class sizes guarantees better student achievement.',c3:'Class size \u2192 teacher quality \u2192 instructional time \u2192 student needs \u2192 school budgets \u2192 policy'},
{id:'A8',co:'Standard',t:'Technology in the Classroom',d:'Education',s:'Investigates whether billions invested in ed-tech actually improve learning, and what happens when access is unequal.',c1:'Ed-tech improves learning with proper support, but access inequities can widen achievement gaps.',c2:'Giving every student a laptop will close the achievement gap.',c3:'Devices \u2192 internet access \u2192 teacher training \u2192 curriculum \u2192 home environment \u2192 funding \u2192 equity'},
{id:'A9',co:'Standard',t:'Later School Start Times',d:'Education',s:'Examines sleep science showing teen biological clocks shift later, making early start times misaligned.',c1:'Adolescent biological clocks shift later during puberty, making early school start times misaligned.',c2:'Teens are just lazy\u2014they should go to bed earlier instead of changing school schedules.',c3:'Sleep biology \u2192 school schedules \u2192 transportation \u2192 parents \u2192 athletics \u2192 teacher contracts \u2192 policy'},
{id:'A10',co:'Standard',t:'Social Media Algorithms & Content',d:'IT',s:'Explores how algorithms maximize engagement and shape what users see\u2014consequences for information quality and polarization.',c1:'Social media algorithms designed to maximize engagement can amplify sensational and polarizing content.',c2:'Algorithms just show people what they want to see\u2014nothing wrong with that.',c3:'Users \u2192 algorithms \u2192 content creators \u2192 advertisers \u2192 regulators \u2192 public discourse \u2192 mental health'},
{id:'A11',co:'Standard',t:'Password Security',d:'IT',s:'Challenges traditional assumptions about password policies. Evaluate security research against common practices.',c1:'Requiring frequent password changes can reduce security by encouraging weaker, predictable passwords.',c2:'More complex password requirements always make systems more secure.',c3:'Users \u2192 IT policies \u2192 password managers \u2192 hackers \u2192 authentication tech \u2192 human behavior'},
{id:'A12',co:'Standard',t:'AI-Generated Content & Misinformation',d:'IT',s:'Examines how AI tools generating realistic text/images/video create challenges for identifying misinformation.',c1:'AI-generated content makes misinformation harder to detect because it mimics credible sources.',c2:'AI detection tools can reliably identify all AI-generated content.',c3:'AI tools \u2192 content creators \u2192 platforms \u2192 consumers \u2192 fact-checkers \u2192 regulation \u2192 trust in media'},
{id:'B1',co:'Spurious Correlations',t:'Ice Cream Sales & Drowning Deaths',d:'Healthcare',s:'Ice cream sales and drowning deaths increase together. Identify hot weather as the confounding variable.',c1:'Hot summer weather causes both increased ice cream sales and increased drowning deaths.',c2:'Eating ice cream causes drowning. Ban ice cream at beaches.',c3:'Weather \u2192 swimming activity \u2192 lifeguards \u2192 pool access \u2192 swim lessons \u2192 supervision \u2192 EMS'},
{id:'B2',co:'Spurious Correlations',t:'Hospital Visits & Mortality Rates',d:'Healthcare',s:'Viral blog claims hospitals kill patients because frequent visitors die more. Identify reverse causation.',c1:'Serious illness causes both frequent hospital visits and higher mortality.',c2:'Hospitals are dangerous. The more you go, the more likely you are to die.',c3:'Patient health \u2192 primary care access \u2192 emergency departments \u2192 insurance \u2192 preventive care'},
{id:'B3',co:'Spurious Correlations',t:'Coffee Shops & Property Values',d:'Business',s:'Subsidize coffee shops to raise property values? Identify wealth as the confounding variable.',c1:'Neighborhood affluence attracts both coffee shops and higher property values independently.',c2:'Coffee shops increase property values. Subsidize them in low-income neighborhoods.',c3:'Neighborhood wealth \u2192 retail development \u2192 property values \u2192 gentrification \u2192 displacement'},
{id:'B4',co:'Spurious Correlations',t:'Email Opens & Customer Purchases',d:'Business',s:'Email openers buy 5x more\u2014send more emails? Identify pre-existing interest as the real driver.',c1:'Customer interest drives both email engagement and purchases.',c2:'Opening marketing emails causes customers to buy more. Send more emails.',c3:'Customer interest \u2192 browse behavior \u2192 email engagement \u2192 purchase decisions \u2192 unsubscribes'},
{id:'B5',co:'Spurious Correlations',t:'Music Lessons & Academic Achievement',d:'Education',s:'Music students have higher GPAs\u2014require music for all? Identify socioeconomic confounding.',c1:'Socioeconomic advantages provide access to both music lessons and academic support.',c2:'Music lessons make students smarter. Require them for all students.',c3:'Family resources \u2192 extracurriculars \u2192 academic support \u2192 school quality \u2192 peer environment'},
{id:'B6',co:'Spurious Correlations',t:'School Spending & Test Scores',d:'Education',s:'Higher-spending districts score lower\u2014cut budgets? High-need districts get more funding.',c1:'Districts with greater needs receive more funding to address existing challenges.',c2:'Higher school spending causes lower test scores. Cut education budgets.',c3:'Student needs \u2192 funding formulas \u2192 resource allocation \u2192 teacher quality \u2192 community factors'},
{id:'B7',co:'Spurious Correlations',t:'Social Media Use & Teen Depression',d:'IT',s:'Depression rose 60% since smartphones\u2014confiscate phones? Evaluate correlation vs. causation.',c1:'Multiple factors\u2014economic stress, academic pressure, social isolation, social media\u2014contribute to rising teen depression.',c2:'Smartphones are destroying children\u2019s mental health. Confiscate all phones.',c3:'Social media \u2192 academic pressure \u2192 economic stress \u2192 family dynamics \u2192 mental health services'},
{id:'B8',co:'Spurious Correlations',t:'Password Policies & Security Breaches',d:'IT',s:'Stricter password policies correlate with MORE breaches. Identify reactive policy adoption.',c1:'Companies that experienced breaches adopt stricter policies in response\u2014breaches came first.',c2:'Strict password policies cause more breaches. Complex passwords make us less secure.',c3:'Breach history \u2192 policy response \u2192 user behavior \u2192 workarounds \u2192 security culture'}
];

let user=null,fDom='All',fCol='All',fSearch='',sortF=null,sortD='asc',expanded=new Set(),ranks={},reviewers=[],rColors={},saveT=null;

function rk(cid,rev){return cid+'_'+rev}
function gc(n){if(rColors[n])return rColors[n];rColors[n]=PAL[Object.keys(rColors).length%PAL.length];return rColors[n]}
function esc(s){return s.replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/'/g,'&#39;')}

function updReviewers(){
  const s=new Set();
  Object.keys(ranks).forEach(k=>{const p=k.indexOf('_');if(p>-1)s.add(k.slice(p+1))});
  if(user)s.add(user);
  reviewers=[...s].sort((a,b)=>a===user?-1:b===user?1:a.localeCompare(b));
}

function loginGo(){const n=document.getElementById('loginInput').value.trim();if(n)login(n)}
function login(name){
  user=name;
  let past=JSON.parse(localStorage.getItem('csRev')||'[]');
  if(!past.includes(name))past.push(name);
  localStorage.setItem('csRev',JSON.stringify(past));
  localStorage.setItem('csCur',name);
  document.getElementById('loginOverlay').classList.add('hidden');
  const b=document.getElementById('userBadge');
  b.style.display='inline-flex';b.style.background=gc(name);
  document.getElementById('userAv').textContent=name[0].toUpperCase();
  document.getElementById('userNm').textContent=name;
  loadRanks();
}
function switchUser(){
  document.getElementById('loginOverlay').classList.remove('hidden');
  document.getElementById('loginInput').value='';
  document.getElementById('loginBtn').disabled=true;
  showRet();
}
function showRet(){
  const past=JSON.parse(localStorage.getItem('csRev')||'[]');
  const all=new Set([...past,...reviewers]);
  const sec=document.getElementById('retSection'),btns=document.getElementById('retBtns');
  if(!all.size){sec.style.display='none';return}
  sec.style.display='block';btns.innerHTML='';
  [...all].sort().forEach(n=>{
    btns.innerHTML+=`<button class="returning-btn" onclick="login('${esc(n)}')"><span class="av" style="background:${gc(n)}">${n[0].toUpperCase()}</span>${esc(n)}</button>`;
  });
}

document.getElementById('loginInput').addEventListener('input',e=>{document.getElementById('loginBtn').disabled=!e.target.value.trim()});

function setSS(t,c){
  const e=document.getElementById('syncSt');
  e.textContent=t;
  e.className='sync-status '+c;
  if(c==='saved')setTimeout(()=>{e.textContent=''},3000)
}

/* ============================================================
   ✅ UPDATED: loadRanks() uses JSONP to avoid CORS on GitHub Pages
   ============================================================ */
function loadRanks(){
  setSS('Loading...','saving');

  const cbName = 'cs_cb_' + Date.now();

  window[cbName] = function(d){
    try{
      ranks = {};
      (d || []).filter(x => x.caseId && x.reviewer).forEach(x=>{
  ranks[rk(x.caseId, x.reviewer)] = { rating: x.rating || 0, notes: x.notes || '' };
});
      updReviewers();
      setSS('Synced','saved');
      render();
    }catch(err){
      setSS('Could not load — offline','error');
      updReviewers();
      render();
    }finally{
      delete window[cbName];
      const s = document.getElementById(cbName);
      if (s) s.remove();
    }
  };

  const s = document.createElement('script');
  s.id = cbName;
  s.src = API + '?action=load&callback=' + cbName;
  s.onerror = () => {
    setSS('Could not load — offline','error');
    delete window[cbName];
    s.remove();
    updReviewers();
    render();
  };

  document.body.appendChild(s);
}

/* ============================================================
   ✅ UPDATED: saveRank() uses mode:'no-cors' to avoid CORS on POST
   ============================================================ */
function saveRank(cid,rev,rat,notes){
  setSS('Saving...','saving');
  const cbName='save_cb_'+Date.now();
  const params=new URLSearchParams({
    action:'save',
    caseId:cid,
    reviewer:rev,
    rating:rat,
    notes:notes||'',
    callback:cbName
  });
  window[cbName]=function(){
    setSS('Saved ✓','saved');
    delete window[cbName];
    const s=document.getElementById(cbName);
    if(s)s.remove();
  };
  const s=document.createElement('script');
  s.id=cbName;
  s.src=API+'?'+params.toString();
  s.onerror=()=>{
    setSS('Save failed','error');
    delete window[cbName];
    s.remove();
  };
  document.body.appendChild(s);
}

function setRat(cid,rat,ev){
  if(ev)ev.stopPropagation();if(!user)return;
  const k=rk(cid,user),ex=ranks[k]||{};
  const nr=ex.rating===rat?0:rat;
  ranks[k]={...ex,rating:nr};updReviewers();render();
  saveRank(cid,user,nr,ex.notes||'');
}

function saveNotes(cid){
  if(!user)return;
  const ta=document.getElementById('n_'+cid+'_'+user);if(!ta)return;
  const k=rk(cid,user),ex=ranks[k]||{};
  ranks[k]={...ex,notes:ta.value};
  clearTimeout(saveT);
  saveT=setTimeout(()=>saveRank(cid,user,ex.rating||0,ta.value),800);
}

function getF(){
  let d=[...CASES];
  if(fDom!=='All')d=d.filter(c=>c.d===fDom);
  if(fCol!=='All')d=d.filter(c=>c.co===fCol);
  if(fSearch){const q=fSearch.toLowerCase();d=d.filter(c=>c.t.toLowerCase().includes(q)||c.s.toLowerCase().includes(q)||c.c1.toLowerCase().includes(q)||c.c2.toLowerCase().includes(q))}
  if(sortF){d.sort((a,b)=>{const av=a[sortF]||'',bv=b[sortF]||'';return sortD==='asc'?av.localeCompare(bv):bv.localeCompare(av)})}
  return d;
}

function stars(cid,rev){
  const k=rk(cid,rev),rat=(ranks[k]||{}).rating||0,me=rev===user;
  let h='';
  for(let i=1;i<=5;i++){
    if(me)h+=`<span class="star ${i<=rat?'filled':''}" onmouseover="hSt(this,${i})" onmouseout="uSt(this)" onclick="setRat('${cid}',${i},event)">\u2605</span>`;
    else h+=`<span class="star ${i<=rat?'of':''} dis">\u2605</span>`;
  }
  return h;
}

function render(){
  const fl=getF(),tb=document.getElementById('tBody');
  document.getElementById('fCnt').textContent=fl.length;
  document.getElementById('colAll').style.display=expanded.size?'inline':'none';
  let h='';
  if(!fl.length){h='<tr><td colspan="7" class="empty-state">No case studies match your filters.</td></tr>'}
  else fl.forEach(c=>{
    const ex=expanded.has(c.id),dc=DC[c.d],cc=c.co==='Standard'?'std':'spur',cl=c.co==='Standard'?'Standard':'Spurious';
    h+=`<tr class="${ex?'expanded':''}" onclick="tog('${c.id}')">
      <td class="cell-id">${c.id}</td>
      <td><span class="bc ${cc}">${cl}</span></td>
      <td class="cell-title">${c.t}</td>
      <td><span class="bd ${dc}"><span class="dot"></span>${c.d}</span></td>
      <td class="cell-scenario">${c.s}</td>
      <td class="rc" onclick="event.stopPropagation()"><div class="rr">`;
    if(!reviewers.length)h+='<span class="nr">No ratings yet</span>';
    else reviewers.forEach(r=>{
      h+=`<div class="rw"><span class="ra" style="background:${gc(r)}">${r[0].toUpperCase()}</span><span class="rn" title="${esc(r)}">${esc(r)}</span><div class="stars">${stars(c.id,r)}</div></div>`;
    });
    h+=`</div></td><td style="text-align:center"><span class="chev ${ex?'open':''}">\u25BE</span></td></tr>`;
    if(ex){
      const l1=c.co==='Spurious Correlations'?'The Correct Claim:':'The Claim:';
      const l2=c.co==='Spurious Correlations'?'The Flawed Claim:':'Claim to Evaluate:';
      h+=`<tr class="detail-row" onclick="event.stopPropagation()"><td colspan="7">
        <div class="dg">
          <div class="dc"><div class="dch"><span class="cb c1">C1</span> Support a Claim</div><div class="dl">${l1}</div><div class="dcl">\u201C${c.c1}\u201D</div></div>
          <div class="dc"><div class="dch"><span class="cb c2">C2</span> Evaluate a Claim</div><div class="dl">${l2}</div><div class="dcl">\u201C${c.c2}\u201D</div></div>
          <div class="dc"><div class="dch"><span class="cb c3">C3</span> Explain the System</div><div class="dl">System Components:</div><div class="ds">${c.c3}</div></div>
        </div>
        <div class="ns"><h4>Reviewer Notes</h4><div class="ng">`;
      reviewers.forEach(r=>{
        const k=rk(c.id,r),notes=(ranks[k]||{}).notes||'',me=r===user;
        h+=`<div class="nc"><div class="nch"><span class="ra" style="background:${gc(r)}">${r[0].toUpperCase()}</span><span>${esc(r)}</span></div>`;
        if(me)h+=`<textarea id="n_${c.id}_${r}" placeholder="Add your notes..." oninput="saveNotes('${c.id}')">${esc(notes)}</textarea>`;
        else if(notes)h+=`<div class="on">${esc(notes)}</div>`;
        else h+=`<div class="en">No notes yet</div>`;
        h+='</div>';
      });
      h+='</div></div></td></tr>';
    }
  });
  tb.innerHTML=h;
}

function tog(id){if(expanded.has(id))expanded.delete(id);else expanded.add(id);render()}
function hSt(el,n){el.parentElement.querySelectorAll('.star').forEach((s,i)=>{if(i<n)s.classList.add('hov')})}
function uSt(el){el.parentElement.querySelectorAll('.star').forEach(s=>s.classList.remove('hov'))}

const DA={All:'act-all',Healthcare:'act-health',Business:'act-biz',Education:'act-edu',IT:'act-it'};
const CA={All:'act-all',Standard:'act-std','Spurious Correlations':'act-spur'};

document.getElementById('domFilt').addEventListener('click',e=>{
  const b=e.target.closest('.pill-btn');if(!b)return;
  fDom=b.dataset.v;
  document.querySelectorAll('#domFilt .pill-btn').forEach(x=>{x.className='pill-btn';if(x.dataset.v===fDom)x.classList.add(DA[fDom])});
  render();
});
document.getElementById('colFilt').addEventListener('click',e=>{
  const b=e.target.closest('.pill-btn');if(!b)return;
  fCol=b.dataset.v;
  document.querySelectorAll('#colFilt .pill-btn').forEach(x=>{x.className='pill-btn';if(x.dataset.v===fCol)x.classList.add(CA[fCol])});
  render();
});
document.getElementById('searchInput').addEventListener('input',e=>{fSearch=e.target.value;render()});
document.querySelectorAll('th.sortable').forEach(th=>{
  th.addEventListener('click',()=>{
    const f=th.dataset.sort;
    if(sortF===f)sortD=sortD==='asc'?'desc':'asc';else{sortF=f;sortD='asc'}
    document.querySelectorAll('.si').forEach(s=>{s.className='si';s.textContent='\u2195'});
    const ic=th.querySelector('.si');ic.className='si on';ic.textContent=sortD==='asc'?'\u2191':'\u2193';
    render();
  });
});
document.getElementById('colAll').addEventListener('click',()=>{expanded.clear();render()});

/* ✅ UPDATED: Removed restart handler entirely */

document.getElementById('btnSignout')?.addEventListener('click', () => {
  localStorage.removeItem('csCur');
  user = null;
  expanded.clear();
  switchUser(); // shows login overlay again
});

// Auto-refresh every 30s
setInterval(()=>{if(user)loadRanks()},30000);

// Auto-login if returning
const prev=localStorage.getItem('csCur');
if(prev){login(prev)}else{showRet();render()}
</script>
</body>
</html>
